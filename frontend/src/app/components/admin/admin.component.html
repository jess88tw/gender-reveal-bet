<div class="admin-container">
  <header class="page-header">
    <a routerLink="/" class="back-btn">â† è¿”å›</a>
    <h1>âš™ï¸ ç®¡ç†å“¡å¾Œå°</h1>
  </header>

  @if (!isLoggedIn()) {
    <div class="login-prompt">
      <p>è«‹å…ˆç™»å…¥ç®¡ç†å“¡å¸³è™Ÿ</p>
      <a routerLink="/" class="btn btn-primary">è¿”å›é¦–é ç™»å…¥</a>
    </div>
  } @else if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>è¼‰å…¥ä¸­...</p>
    </div>
  } @else if (error()) {
    <div class="error-banner">
      <p>âš ï¸ {{ error() }}</p>
      <button (click)="loadData()" class="btn btn-small">é‡è©¦</button>
    </div>
  } @else {
    <!-- Success/Error Messages -->
    @if (successMessage()) {
      <div class="success-banner">
        <p>âœ… {{ successMessage() }}</p>
        <button (click)="clearMessages()" class="close-btn">âœ•</button>
      </div>
    }

    <!-- Stats Overview -->
    <section class="stats-overview">
      <h2>ğŸ“Š ä¸‹æ³¨çµ±è¨ˆ</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-number">{{ totalBets() }}</span>
          <span class="stat-label">ç¸½ä¸‹æ³¨æ•¸</span>
        </div>
        <div class="stat-card paid">
          <span class="stat-number">{{ paidBets().length }}</span>
          <span class="stat-label">å·²ä»˜æ¬¾</span>
        </div>
        <div class="stat-card unpaid">
          <span class="stat-number">{{ unpaidBets().length }}</span>
          <span class="stat-label">å¾…ä»˜æ¬¾</span>
        </div>
        <div class="stat-card pool">
          <span class="stat-number">NT$ {{ totalPool() | number }}</span>
          <span class="stat-label">çé‡‘æ± </span>
        </div>
      </div>
      <div class="gender-stats">
        <div class="gender-stat boy">
          <span>ğŸ‘¦ ç”·ç”Ÿï¼š{{ boyBets().length }} æ³¨</span>
        </div>
        <div class="gender-stat girl">
          <span>ğŸ‘§ å¥³ç”Ÿï¼š{{ girlBets().length }} æ³¨</span>
        </div>
      </div>
    </section>

    <!-- Bet Management -->
    <section class="bet-management">
      <h2>ğŸ’³ ä¸‹æ³¨ç®¡ç†</h2>
      @if (allBets().length === 0) {
        <p class="empty">ç›®å‰æ²’æœ‰ä¸‹æ³¨è¨˜éŒ„</p>
      } @else {
        <div class="bet-table">
          @for (bet of allBets(); track bet.id) {
            <div class="bet-row" [class.paid]="bet.isPaid" [class.unpaid]="!bet.isPaid">
              <div class="bet-user">
                <strong>{{ bet.user?.name || 'æœªçŸ¥' }}</strong>
                <small>{{ bet.user?.email }}</small>
              </div>
              <div class="bet-gender">
                {{ bet.gender === 'BOY' ? 'ğŸ‘¦ ç”·ç”Ÿ' : 'ğŸ‘§ å¥³ç”Ÿ' }}
              </div>
              <div class="bet-amount">
                NT$ {{ bet.amount | number }}
              </div>
              <div class="bet-date">
                {{ bet.createdAt | date:'MM/dd HH:mm' }}
              </div>
              <div class="bet-action">
                @if (bet.isPaid) {
                  <span class="status-badge paid">âœ“ å·²ä»˜æ¬¾</span>
                } @else {
                  <button
                    class="btn btn-confirm"
                    (click)="confirmPayment(bet)"
                    [disabled]="actionLoading()"
                  >
                    ç¢ºèªä»˜æ¬¾
                  </button>
                }
              </div>
            </div>
          }
        </div>
      }
    </section>

    <!-- Reveal & Draw Section -->
    <section class="reveal-section">
      <h2>ğŸ‰ æ­æ›‰ & æŠ½ç</h2>

      @if (revealConfig()?.isRevealed) {
        <!-- Already Revealed -->
        <div class="revealed-info">
          <p class="revealed-gender">
            å·²æ­æ›‰ï¼š{{ revealConfig()!.revealedGender === 'BOY' ? 'ğŸ‘¦ ç”·ç”Ÿ' : 'ğŸ‘§ å¥³ç”Ÿ' }}
          </p>

          @if (revealConfig()!.winnerId) {
            <div class="winner-info">
              <p>ğŸ† å¾—çè€…å·²æŠ½å‡º</p>
              @if (adminWinner()) {
                <div class="winner-detail">
                  <p class="winner-name">ğŸŠ {{ adminWinner()!.name }}</p>
                  @if (adminPrizeInfo()) {
                    <p>ç¸½çé‡‘æ± ï¼šNT$ {{ adminPrizeInfo()!.totalPool | number }}</p>
                    <p>æ‰‹çºŒè²» (10%)ï¼šNT$ {{ adminPrizeInfo()!.fee | number }}</p>
                    <p class="prize-amount">å¾—ä¸»çé‡‘ï¼šNT$ {{ adminPrizeInfo()!.winnerPrize | number }}</p>
                  }
                </div>
              }
            </div>
          } @else {
            <!-- Draw Winner -->
            <div class="draw-section">
              <p>çŒœå°äººæ•¸ï¼š{{ revealConfig()!.revealedGender === 'BOY' ? boyBets().length : girlBets().length }} äºº</p>
              <button
                class="btn btn-draw"
                (click)="drawWinner()"
                [disabled]="actionLoading()"
              >
                ğŸ² æŠ½å‡ºå¾—çè€…
              </button>
            </div>
          }
        </div>
      } @else {
        <!-- Not Yet Revealed -->
        <div class="reveal-actions">
          <p>é¸æ“‡å¯¶å¯¶çš„æ€§åˆ¥ä¾†æ­æ›‰ï¼š</p>
          <div class="reveal-buttons">
            <button
              class="btn btn-reveal boy"
              (click)="revealGender('BOY')"
              [disabled]="actionLoading()"
            >
              ğŸ‘¦ æ­æ›‰ç‚ºç”·ç”Ÿ
            </button>
            <button
              class="btn btn-reveal girl"
              (click)="revealGender('GIRL')"
              [disabled]="actionLoading()"
            >
              ğŸ‘§ æ­æ›‰ç‚ºå¥³ç”Ÿ
            </button>
          </div>
          <p class="warning">âš ï¸ æ­æ›‰å¾Œç„¡æ³•ä¿®æ”¹ï¼Œä¸‹æ³¨å°‡é—œé–‰</p>
        </div>
      }
    </section>

    <!-- Dev Tools -->
    <section class="dev-section">
      <h2>ğŸ› ï¸ é–‹ç™¼å·¥å…·</h2>
      <p class="dev-warning">ä»¥ä¸‹æ“ä½œåƒ…ä¾›é–‹ç™¼æ¸¬è©¦ä½¿ç”¨</p>
      <button
        class="btn btn-danger"
        (click)="clearAllData()"
        [disabled]="actionLoading()"
      >
        ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰è³‡æ–™
      </button>
    </section>
  }
</div>
