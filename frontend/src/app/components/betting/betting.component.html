<div class="betting-container">
  <header class="page-header">
    <a routerLink="/" class="back-btn">â† è¿”å›</a>
    <h1>ğŸ² ä¸‹æ³¨</h1>
  </header>

  @if (!isLoggedIn()) {
    <div class="login-prompt">
      <p>è«‹å…ˆç™»å…¥æ‰èƒ½ä¸‹æ³¨</p>
      <a routerLink="/" class="btn btn-primary">è¿”å›é¦–é ç™»å…¥</a>
    </div>
  } @else if (success()) {
    <!-- Success State -->
    <div class="success-state">
      <div class="success-icon">ğŸ‰</div>
      <h2>ä¸‹æ³¨æˆåŠŸï¼</h2>
      <p>æ‚¨å·²æˆåŠŸä¸‹æ³¨ {{ selectedGender() === "BOY" ? "ç”·ç”Ÿ" : "å¥³ç”Ÿ" }}</p>
      <p class="bet-summary">
        <span class="label">é‡‘é¡:</span>
        <span class="value">NT$ {{ amount() | number }}</span>
      </p>
      <p class="bet-summary">
        <span class="label">ç±¤æ•¸:</span>
        <span class="value">{{ ticketCount() }} å¼µ</span>
      </p>
      <div class="payment-reminder">
        <h4>ğŸ’³ ä»˜æ¬¾æé†’</h4>
        <p>è«‹æ–¼ä¸‹æ³¨å¾Œ 3 æ—¥å…§å®Œæˆä»˜æ¬¾</p>
        <p>åŒ¯æ¬¾å¸³è™Ÿ: XXX-XXXX-XXXX-XXXX</p>
        <p>åŒ¯æ¬¾å¾Œè«‹é€šçŸ¥ä¸»è¾¦äººç¢ºèª</p>
      </div>
      <div class="success-actions">
        <button (click)="resetForm()" class="btn btn-primary">ç¹¼çºŒä¸‹æ³¨</button>
        <button (click)="goToMyBets()" class="btn btn-secondary">
          æŸ¥çœ‹æˆ‘çš„ä¸‹æ³¨
        </button>
      </div>
    </div>
  } @else {
    <!-- Betting Form -->
    <div class="betting-form">
      <!-- Step 1: Select Gender -->
      <section class="form-section">
        <h2>Step 1: é¸æ“‡æ€§åˆ¥</h2>
        <div class="gender-selection">
          <button
            class="gender-btn boy-btn"
            [class.selected]="selectedGender() === 'BOY'"
            (click)="selectGender('BOY')"
          >
            <span class="icon">ğŸ‘¦</span>
            <span class="label">ç”·ç”Ÿ</span>
          </button>
          <button
            class="gender-btn girl-btn"
            [class.selected]="selectedGender() === 'GIRL'"
            (click)="selectGender('GIRL')"
          >
            <span class="icon">ğŸ‘§</span>
            <span class="label">å¥³ç”Ÿ</span>
          </button>
        </div>
      </section>

      <!-- Step 2: Select Ticket Count -->
      <section class="form-section">
        <h2>Step 2: é¸æ“‡ç±¤æ•¸</h2>
        <p class="hint">æ¯å¼µç±¤ NT$200</p>

        <div class="ticket-selector">
          <button
            class="qty-btn"
            (click)="decrementTickets()"
            [disabled]="ticketCount() <= 1"
          >
            âˆ’
          </button>
          <input
            type="number"
            [value]="ticketCount()"
            #ticketInput
            (input)="setTicketCount(ticketInput.valueAsNumber)"
            min="1"
            class="qty-input"
          />
          <button class="qty-btn" (click)="incrementTickets()">+</button>
        </div>

        <div class="quick-select">
          @for (count of [1, 3, 5, 10]; track count) {
            <button
              class="quick-btn"
              [class.active]="ticketCount() === count"
              (click)="setTicketCount(count)"
            >
              {{ count }} å¼µ
            </button>
          }
        </div>
      </section>

      <!-- Step 3: Payment Method -->
      <section class="form-section">
        <h2>Step 3: ä»˜æ¬¾æ–¹å¼</h2>
        <div class="payment-options">
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="bank_transfer"
              [checked]="paymentMethod() === 'bank_transfer'"
              (change)="setPaymentMethod('bank_transfer')"
            />
            <span class="option-label">ğŸ¦ éŠ€è¡Œè½‰å¸³</span>
          </label>
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="line_pay"
              [checked]="paymentMethod() === 'line_pay'"
              (change)="setPaymentMethod('line_pay')"
            />
            <span class="option-label">ğŸ’š LINE Pay</span>
          </label>
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="cash"
              [checked]="paymentMethod() === 'cash'"
              (change)="setPaymentMethod('cash')"
            />
            <span class="option-label">ğŸ’µ ç¾é‡‘</span>
          </label>
        </div>
      </section>

      <!-- Summary -->
      <section class="summary-section">
        <h3>ä¸‹æ³¨æ‘˜è¦</h3>
        <div class="summary-row">
          <span>æ€§åˆ¥</span>
          <span>
            @if (selectedGender()) {
              {{ selectedGender() === "BOY" ? "ğŸ‘¦ ç”·ç”Ÿ" : "ğŸ‘§ å¥³ç”Ÿ" }}
            } @else {
              å°šæœªé¸æ“‡
            }
          </span>
        </div>
        <div class="summary-row">
          <span>ç±¤æ•¸</span>
          <span>{{ ticketCount() }} å¼µ</span>
        </div>
        <div class="summary-row total">
          <span>ç¸½é‡‘é¡</span>
          <span>NT$ {{ amount() | number }}</span>
        </div>
      </section>

      <!-- Error Message -->
      @if (error()) {
        <div class="error-message">âš ï¸ {{ error() }}</div>
      }

      <!-- Submit Button -->
      <button
        class="submit-btn"
        [disabled]="!canSubmit()"
        (click)="submitBet()"
      >
        @if (submitting()) {
          <span class="spinner"></span> è™•ç†ä¸­...
        } @else {
          ç¢ºèªä¸‹æ³¨ NT$ {{ amount() | number }}
        }
      </button>
    </div>
  }
</div>
