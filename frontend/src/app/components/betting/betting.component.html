<div class="betting-container">
  <header class="page-header">
    <a routerLink="/" class="back-btn">← 返回</a>
    <h1>🎲 下注</h1>
  </header>

  @if (!isLoggedIn()) {
    <div class="login-prompt">
      <p>請先登入才能下注</p>
      <a routerLink="/" class="btn btn-primary">返回首頁登入</a>
    </div>
  } @else if (success()) {
    <!-- Success State -->
    <div class="success-state">
      <div class="success-icon">🎉</div>
      <h2>下注成功！</h2>
      <p class="success-gender">
        您已成功下注
        <span class="gender-tag" [class.boy]="selectedGender() === 'BOY'" [class.girl]="selectedGender() === 'GIRL'">
          {{ selectedGender() === "BOY" ? "👦 男生" : "👧 女生" }}
        </span>
      </p>

      <div class="success-details">
        <div class="detail-row">
          <span class="detail-label">下注金額</span>
          <span class="detail-value highlight">NT$ 200</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">付款方式</span>
          <span class="detail-value">
            @if (paymentMethod() === 'bank_transfer') {
              🏦 銀行轉帳
            } @else if (paymentMethod() === 'line_pay') {
              💚 LINE Pay
            } @else {
              💵 現金
            }
          </span>
        </div>
      </div>

      <!-- 依付款方式顯示不同提醒 -->
      @if (paymentMethod() === 'bank_transfer') {
        <div class="payment-reminder bank">
          <h4>🏦 銀行轉帳資訊</h4>
          <p>請於下注後 <strong>3 日內</strong>完成匯款</p>
          <div class="payment-info-box">
            <p>📩 請私訊主辦人取得匯款帳號</p>
          </div>
          <p class="reminder-note">匯款後請通知主辦人確認 ✅</p>
        </div>
      } @else if (paymentMethod() === 'line_pay') {
        <div class="payment-reminder line">
          <h4>💚 LINE Pay 付款</h4>
          <p>請於下注後 <strong>3 日內</strong>完成轉帳</p>
          <div class="payment-info-box">
            <p>請透過 LINE Pay 轉帳給主辦人</p>
          </div>
          <p class="reminder-note">轉帳後請截圖通知主辦人確認 📸</p>
        </div>
      } @else {
        <div class="payment-reminder cash">
          <h4>💵 現金付款</h4>
          <p>請於活動當天或約定時間完成付款</p>
          <div class="payment-info-box">
            <p>請當面交給主辦人即可</p>
          </div>
          <p class="reminder-note">交付後主辦人會確認您的付款狀態 🤝</p>
        </div>
      }

      <div class="success-actions">
        <button (click)="goToMyBets()" class="btn btn-primary">
          📋 查看我的下注
        </button>
        <a routerLink="/" class="btn btn-secondary">🏠 回首頁</a>
      </div>
    </div>
  } @else {
    <!-- Betting Form -->
    <div class="betting-form">
      <!-- Step 1: Select Gender -->
      <section class="form-section">
        <h2>Step 1: 選擇性別</h2>
        <div class="gender-selection">
          <button
            class="gender-btn boy-btn"
            [class.selected]="selectedGender() === 'BOY'"
            (click)="selectGender('BOY')"
          >
            <span class="icon">👦</span>
            <span class="label">男生</span>
          </button>
          <button
            class="gender-btn girl-btn"
            [class.selected]="selectedGender() === 'GIRL'"
            (click)="selectGender('GIRL')"
          >
            <span class="icon">👧</span>
            <span class="label">女生</span>
          </button>
        </div>
      </section>

      <!-- Step 2: Payment Method -->
      <section class="form-section">
        <h2>Step 2: 付款方式</h2>
        <p class="hint">每人限一注 NT$200</p>
        <div class="payment-options">
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="bank_transfer"
              [checked]="paymentMethod() === 'bank_transfer'"
              (change)="setPaymentMethod('bank_transfer')"
            />
            <span class="option-label">🏦 銀行轉帳</span>
          </label>
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="line_pay"
              [checked]="paymentMethod() === 'line_pay'"
              (change)="setPaymentMethod('line_pay')"
            />
            <span class="option-label">💚 LINE Pay</span>
          </label>
          <label class="payment-option">
            <input
              type="radio"
              name="payment"
              value="cash"
              [checked]="paymentMethod() === 'cash'"
              (change)="setPaymentMethod('cash')"
            />
            <span class="option-label">💵 現金</span>
          </label>
        </div>
      </section>

      @if (alreadyBet()) {
        <div class="error-message">⚠️ 您已經下注過了，每人限一注</div>
      }

      <!-- Summary -->
      <section class="summary-section">
        <h3>下注摘要</h3>
        <div class="summary-row">
          <span>性別</span>
          <span>
            @if (selectedGender()) {
              {{ selectedGender() === "BOY" ? "👦 男生" : "👧 女生" }}
            } @else {
              尚未選擇
            }
          </span>
        </div>
        <div class="summary-row total">
          <span>總金額</span>
          <span>NT$ 200</span>
        </div>
      </section>

      <!-- Error Message -->
      @if (error()) {
        <div class="error-message">⚠️ {{ error() }}</div>
      }

      <!-- Submit Button -->
      <button
        class="submit-btn"
        [disabled]="!canSubmit()"
        (click)="submitBet()"
      >
        @if (submitting()) {
          <span class="spinner"></span> 處理中...
        } @else {
          確認下注 NT$ 200
        }
      </button>
    </div>
  }
</div>
